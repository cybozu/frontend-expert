<!DOCTYPE html><html lang="ja"><head><title>TypeScript | サイボウズ フロントエンドエキスパートチーム</title><meta charSet="utf-8"/><meta name="viewport" content="initial-scale=1.0, width=device-width"/><meta name="description" content="サイボウズ フロントエンドエキスパートチームのウェブサイトです"/><link rel="icon" type="image/png" sizes="32x32" href="/frontend-expert/icons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/frontend-expert/icons/favicon-16x16.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="TypeScript | サイボウズ フロントエンドエキスパートチーム"/><meta name="twitter:description" content="サイボウズ フロントエンドエキスパートチームのウェブサイトです"/><meta name="twitter:image " content="https://cybozu.github.io/frontend-expert/ogp/ogp.jpg"/><meta property="og:type" content="article"/><meta property="og:title" content="TypeScript | サイボウズ フロントエンドエキスパートチーム"/><meta property="og:site_name" content="サイボウズ フロントエンドエキスパートチーム"/><meta property="og:description" content="サイボウズ フロントエンドエキスパートチームのウェブサイトです"/><meta property="og:image" content="https://cybozu.github.io/frontend-expert/ogp/ogp.jpg"/><link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/frontend-expert/feeds/atom.xml"/><meta name="next-head-count" content="16"/><link rel="preload" href="/frontend-expert/_next/static/css/d15332f741e09aa2.css" as="style"/><link rel="stylesheet" href="/frontend-expert/_next/static/css/d15332f741e09aa2.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/frontend-expert/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/frontend-expert/_next/static/chunks/webpack-b0f44a7ac00bf3cb.js" defer=""></script><script src="/frontend-expert/_next/static/chunks/framework-742985a85518e1e1.js" defer=""></script><script src="/frontend-expert/_next/static/chunks/main-242b1a0e32bf923c.js" defer=""></script><script src="/frontend-expert/_next/static/chunks/pages/_app-ff35bec35d2bc313.js" defer=""></script><script src="/frontend-expert/_next/static/chunks/247-c193c27d2f31cb66.js" defer=""></script><script src="/frontend-expert/_next/static/chunks/836-39a19b1bc48d36a2.js" defer=""></script><script src="/frontend-expert/_next/static/chunks/pages/tags/%5Btag%5D-6dba5b90ce91c053.js" defer=""></script><script src="/frontend-expert/_next/static/CO4eznkXlDDSZXMGOnJzP/_buildManifest.js" defer=""></script><script src="/frontend-expert/_next/static/CO4eznkXlDDSZXMGOnJzP/_ssgManifest.js" defer=""></script><script src="/frontend-expert/_next/static/CO4eznkXlDDSZXMGOnJzP/_middlewareManifest.js" defer=""></script></head><body><div id="__next"><style data-emotion="css ruypru">.css-ruypru{width:100%;}.css-ruypru .main{max-width:100%;background-color:white;}.css-ruypru .main .content{margin:0 auto;max-width:var(--content-width);box-sizing:border-box;padding:1rem 1rem 1.5rem;min-height:400px;}</style><div class="css-ruypru"><style data-emotion="css 14l5li6">.css-14l5li6{padding:1.2rem 0 1rem;background-color:var(--primary-color);}.css-14l5li6 .content{max-width:var(--content-width);margin:0 auto;padding:0 1rem;box-sizing:border-box;}.css-14l5li6 h1{font-size:1.6rem;}.css-14l5li6 .navigation ul{margin:0;list-style:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}.css-14l5li6 .navigation ul li{padding:0.2rem 0;font-size:1rem;}.css-14l5li6 .navigation ul li:not(:last-child)::after{content:"/";margin:0 0.4rem;color:var(--light-font-color);}.css-14l5li6 a{color:var(--light-font-color);}</style><header class="css-14l5li6"><div class="content"><h1><a href="/frontend-expert"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27200%27%20height=%2778%27/%3e"/></span><img alt="Frontend Expert Team Logo" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="Frontend Expert Team Logo" src="/frontend-expert/logo.png" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></a></h1><nav class="navigation"><ul><li><a href="/frontend-expert/members">Members</a></li><li><a href="/frontend-expert/posts">Posts</a></li><li><a href="https://cybozu.co.jp/company/job/recruitment/list/front_end_expert.html" target="_blank" rel="noopener noreferrer">Recruiting</a></li></ul></nav></div></header><main class="main"><div class="content"><h2>TypeScript</h2><style data-emotion="css 3x8wln">.css-3x8wln .item{font-size:1.1rem;padding:12px 4px 8px;}.css-3x8wln .item+.item{margin-top:8px;border-top:1px solid #ebebeb;}.css-3x8wln .title{font-size:1.2em;}.css-3x8wln .tags{margin-top:12px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;grid-gap:8px;}.css-3x8wln .tag{font-size:0.5em;border:1px solid;padding:2px 4px;border-radius:2px;color:currentColor;}.css-3x8wln .date{font-size:0.8em;}.css-3x8wln .author{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;grid-gap:8px;padding-top:8px;}.css-3x8wln .author img{border-radius:4px;}</style><div class="css-3x8wln"><div class="item"><a href="/frontend-expert/posts/ergonomic-brand-checks-for-private-fields"><div class="title">ES2022 と TypeScript 4.5 に入るプライベートフィールドのための in 演算子について</div><div class="author"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:30px;height:30px;background:none;opacity:1;border:0;margin:0;padding:0;position:relative"><img alt="sosukesuzuki" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="fixed" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="sosukesuzuki" src="/frontend-expert//member-icons/sosukesuzuki.jpg" decoding="async" data-nimg="fixed" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span><span class="date">2021-11-11</span></div><div class="tags"><span class="tag">ECMAScript</span><span class="tag">TypeScript</span></div></a></div></div></div></main><style data-emotion="css 1n88omd">.css-1n88omd{padding:2.4rem 0;background-color:var(--primary-color);color:white;}.css-1n88omd .content{max-width:var(--content-width);padding:0 1.2rem;box-sizing:border-box;margin:0 auto;}.css-1n88omd a{color:white;}.css-1n88omd ul{list-style:none;margin-bottom:2.5rem;}.css-1n88omd ul li{font-size:1.2rem;margin-bottom:0.5rem;}.css-1n88omd small{font-size:1rem;}</style><footer class="css-1n88omd"><div class="content"><ul><li><a href="https://cybozu.co.jp/">サイボウズ 企業情報</a></li><li><a href="https://www.cybozu.com/jp/">cybozu.com</a></li><li><a href="https://blog.cybozu.io/">サイボウズエンジニアのブログ Cybozu Inside Out</a></li><li><a href="https://tech.cybozu.io/">Cybozu Tech</a></li><li><a href="https://cybozu.co.jp/company/job/recruitment/">採用情報</a></li></ul><small>Copyright © Cybozu, Inc.</small></div></footer></div>;<!-- --></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"posts":[{"slug":"ergonomic-brand-checks-for-private-fields","content":"\u003cp\u003e2021年7月に行われた TC39 ミーティングで \u003ca href=\"https://github.com/tc39/proposal-private-fields-in-in\"\u003eErgonomic brand checks for Private Fields\u003c/a\u003e というプロポーザルが Stage 4 になりました。\nこのプロポーザルは、ES2022 に含まれる予定です。また、\u003ca href=\"https://devblogs.microsoft.com/typescript/announcing-typescript-4-5-rc/#private-field-presence-checks\"\u003eTypeScript 4.5 にも含まれる予定です\u003c/a\u003e。\u003c/p\u003e\n\u003cp\u003eこの記事では、Ergonomic brand checks for Private Fields について解説します。\u003c/p\u003e\n\u003ch2\u003e概要\u003c/h2\u003e\n\u003cp\u003eErgonomic brand checks for Private Fields は、\u003ccode\u003ein\u003c/code\u003e 演算子を使ったプライベートフィールドの有無の判定を可能にするプロポーザルです。\u003c/p\u003e\n\u003ch3\u003e現在の \u003ccode\u003ein\u003c/code\u003e 演算子\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003ein\u003c/code\u003e 演算子は、オブジェクトが特定の名前のプロパティを持っているかどうかを判定するための二項演算子です。\n左辺にプロパティの名前、右辺にオブジェクトを受け取ります。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e obj \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token literal-property property\"\u003eprop1\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token console class-name\"\u003econsole\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003elog\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"prop1\"\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e obj\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// true\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch3\u003e新しい \u003ccode\u003ein\u003c/code\u003e 演算子\u003c/h3\u003e\n\u003cp\u003eErgonomic brand checks for Private Fields では、この \u003ccode\u003ein\u003c/code\u003e 演算子を拡張し、左辺に Private Identifier を取れるようになります。\u003c/p\u003e\n\u003cp\u003ePrivate Identifier は \u003ccode\u003e#foo\u003c/code\u003e のような形をした特別な識別子で、クラスのプライベートフィールドを表現するのに使われます。\u003c/p\u003e\n\u003cp\u003eたとえば、次のコードではクラス \u003ccode\u003eFoo\u003c/code\u003e は、\u003ccode\u003e#prop1\u003c/code\u003e というプライベートフィールドを持ちます。\nこのとき \u003ccode\u003e#prop1\u003c/code\u003e は Private Identifier です。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eFoo\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  #prop1\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e拡張された \u003ccode\u003ein\u003c/code\u003e 演算子では、次のようにしてオブジェクトにプライベートフィールドが含まれるかどうかをチェックできます。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003e#prop1 \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e obj\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eしかし、プライベートフィールドはプライベートなので上記のコードはそのフィールドを持つクラスの中でのみ使うことができます。\u003c/p\u003e\n\u003cp\u003eつまり、次のようにクラスの外でプライベートフィールドに対して \u003ccode\u003ein\u003c/code\u003e を使うとエラーになります。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eFoo\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  #prop1\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token console class-name\"\u003econsole\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003elog\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e#prop1 \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eFoo\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e// Uncaught SyntaxError: Private field '#prop1' must be declared in an enclosing class\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eしかし、次のようなコードはエラーになりません。メソッド \u003ccode\u003efoo\u003c/code\u003e はクラス \u003ccode\u003eFoo\u003c/code\u003e の中にあるので、Private Identifier である \u003ccode\u003e#foo\u003c/code\u003e を \u003ccode\u003ein\u003c/code\u003e 演算子の左辺として使うことができます。\nそして、この \u003ccode\u003efoo\u003c/code\u003e の中で \u003ccode\u003ethis\u003c/code\u003e は \u003ccode\u003eFoo\u003c/code\u003e のインスタンスであり、それには当然 \u003ccode\u003e#prop1\u003c/code\u003e というプライベートプロパティが存在するので、\u003ccode\u003e#prop1 in this\u003c/code\u003e の結果は \u003ccode\u003etrue\u003c/code\u003e になります。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eFoo\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  #prop1\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token function\"\u003efoo\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e #prop1 \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token console class-name\"\u003econsole\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003elog\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eFoo\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003efoo\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// true\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2\u003eモチベーション\u003c/h2\u003e\n\u003cp\u003e存在しないプライベートフィールドにアクセスすると、実行時エラーが発生します。\u003c/p\u003e\n\u003cp\u003eその挙動と try / catch を組み合わせて、次のようにしてオブジェクトのクラスを判定できます。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eFoo\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  #brand\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"token function\"\u003eisFoo\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003eobj\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword control-flow\"\u003etry\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      obj\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003e#brand\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003ecatch\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token boolean\"\u003efalse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003ccode\u003eobj.#brand\u003c/code\u003e にアクセスしたとき、\u003ccode\u003eobj\u003c/code\u003e が Foo のインスタンスでない場合、実行時エラーが発生し \u003ccode\u003ecatch\u003c/code\u003e に入り \u003ccode\u003efalse\u003c/code\u003e が返されます。\nこのようにして、あるオブジェクトが\u003ccode\u003eFoo\u003c/code\u003eのインスタンスであるかを検証するスタティックメソッドを作れます。\u003c/p\u003e\n\u003cp\u003eですが、このパターンは冗長です。\u003ccode\u003ein\u003c/code\u003e 演算子を使えばもっと短く書けます。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eFoo\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  #brand\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"token function\"\u003eisFoo\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003eobj\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e #brand \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e obj\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eこれが、このプロポーザルの主なモチベーションです。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Operators/instanceof\"\u003e\u003ccode\u003einstanceof\u003c/code\u003e 演算子\u003c/a\u003eも基本的にはこの目的のために使えます。しかし \u003ccode\u003einstanceof\u003c/code\u003e 演算子はプロトタイプに依存するので、プロトタイプを書き換えることでその挙動を変更できます。\u003c/p\u003e\n\u003cp\u003e次の例では、 \u003ccode\u003eobj\u003c/code\u003e は \u003ccode\u003eFoo\u003c/code\u003e のインスタンスではありませんが、後からプロトタイプを書き換えているので \u003ccode\u003eobj instanceof Foo\u003c/code\u003e は \u003ccode\u003etrue\u003c/code\u003e になっています。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eFoo\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e foo \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eFoo\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e obj \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token known-class-name class-name\"\u003eObject\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003esetPrototypeOf\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eobj\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e foo\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token console class-name\"\u003econsole\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003elog\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eobj \u003cspan class=\"token keyword\"\u003einstanceof\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eFoo\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// true\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eまた、\u003ca href=\"https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Symbol/hasInstance\"\u003eSymbol.hasInstance\u003c/a\u003e を使って \u003ccode\u003einstanceof\u003c/code\u003e の挙動を変更することも可能です。\u003c/p\u003e\n\u003cp\u003eなので、より安全にオブジェクトのもとになったクラスを検証したい場合は \u003ccode\u003ein\u003c/code\u003e 演算子を使うと良いでしょう。\u003c/p\u003e\n\u003ch2\u003e参考リンク\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://tc39.es/ecma262/#prod-RelationalExpression\"\u003ehttps://tc39.es/ecma262/#prod-RelationalExpression\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://tc39.es/ecma262/#prod-PrivateIdentifier\"\u003ehttps://tc39.es/ecma262/#prod-PrivateIdentifier\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/tc39/proposal-private-fields-in-in\"\u003ehttps://github.com/tc39/proposal-private-fields-in-in\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Operators/in\"\u003ehttps://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Operators/in\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n","metaData":{"title":"ES2022 と TypeScript 4.5 に入るプライベートフィールドのための in 演算子について","author":"sosukesuzuki","createdAt":"2021-11-11","summary":"ES2022 と TypeScript 4.5 に入る現在 Stage 4 の提案 Ergonomic brand checks for Private Fields についての解説です。","tags":["ECMAScript","TypeScript"],"updatedAt":"2021-11-11"}}],"tag":"TypeScript"},"__N_SSG":true},"page":"/tags/[tag]","query":{"tag":"TypeScript"},"buildId":"CO4eznkXlDDSZXMGOnJzP","assetPrefix":"/frontend-expert","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>