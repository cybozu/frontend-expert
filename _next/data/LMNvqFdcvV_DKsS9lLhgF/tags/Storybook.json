{"pageProps":{"posts":[{"type":"markdown","href":"/posts/storybook-interactive-stories","slug":"storybook-interactive-stories","content":"<p><a href=\"https://github.com/storybookjs/storybook/releases/tag/v6.4.0\">Storybook の 6.4.0 がリリース</a>され、<code>Interactive stories</code>が新機能として追加されました。詳細は<a href=\"https://storybook.js.org/blog/interactive-stories-beta/\">Storybook のブログ</a>でも記載されています。</p>\n<h2>概要</h2>\n<p>Interactive stories の Addon を追加すると、testing-library で定義した操作を Storybook 上で確認することができるようになります。</p>\n<p>次の gif のようにユーザー操作に対するコンポーネントの状態を UI(Addon)からステップごとに確認できます。</p>\n<p><img src=\"/frontend-expert/image/storybook-interactive-stories/capture.gif\" alt=\"Interactive addonを使った例\" width=\"360\" height=\"240\" ></p>\n<h2>導入手順</h2>\n<ol>\n<li>パッケージを追加する</li>\n<li>Storybook の<code>main.js</code>に設定を追加する</li>\n<li>Interactive stories 用の story を<code>stories.tsx</code>に追加する</li>\n</ol>\n<h3>1. パッケージを追加する</h3>\n<p>Interactive addon を利用するには次のパッケージが必要です。<br>\n(今回は React のコンポーネントを対象としています)</p>\n<ul>\n<li>@storybook/addon-interactions</li>\n<li>@storybook/react</li>\n<li>@storybook/testing-library</li>\n</ul>\n<p>次のコマンドを実行してインストールします。</p>\n<p><code>npm i -D @storybook/addon-interactions @storybook/react @storybook/testing-library</code></p>\n<p>今回試したバージョンは次になります。</p>\n<div class=\"remark-highlight\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"devDependencies\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"@storybook/addon-interactions\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"6.4.0\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"@storybook/react\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"6.4.0\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"@storybook/testing-library\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"0.0.7\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h3>2. Storybook の<code>main.js</code>に設定を追加する</h3>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\">module<span class=\"token punctuation\">.</span><span class=\"token property-access\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">stories</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"../src/components/**/**/*.stories.@(js|jsx|ts|tsx)\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">addons</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"@storybook/addon-interactions\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// addonの追加</span>\n  <span class=\"token literal-property property\">features</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">interactionsDebugger</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// Interactive storiesをaddonで1ステップずつ確認できるようにするのに必要</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h3>3. Interactive stories 用の story を<code>stories.tsx</code>に追加する</h3>\n<p>例えば、次のサンプルコードでは Storybook 上にマウントされたコンポーネントに対して、<code>Add</code>のラベルがついたボタンを 4 回クリックした後に<code>Reset</code>のボタンをクリックする story を<code>@storybook/testing-library</code>を使って追加しています。</p>\n<div class=\"remark-highlight\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// Interactive storiesに関係ある部分しか記載してません</span>\n<span class=\"token keyword\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> within<span class=\"token punctuation\">,</span> userEvent <span class=\"token punctuation\">}</span></span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@storybook/testing-library\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token maybe-class-name\">Template</span><span class=\"token operator\">:</span> <span class=\"token maybe-class-name\">Story</span><span class=\"token operator\">&#x3C;</span><span class=\"token maybe-class-name\">ExampleComponentProps</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">(</span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span><span class=\"token class-name\">ExampleComponent</span></span> <span class=\"token spread\"><span class=\"token punctuation\">{</span><span class=\"token spread operator\">...</span>args<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token maybe-class-name\">Default</span> <span class=\"token operator\">=</span> <span class=\"token maybe-class-name\">Template</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">bind</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token maybe-class-name\">Default</span><span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">play</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> canvasElement <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> canvas <span class=\"token operator\">=</span> <span class=\"token function\">within</span><span class=\"token punctuation\">(</span>canvasElement<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">await</span> userEvent<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">click</span><span class=\"token punctuation\">(</span>canvas<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getByRole</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"button\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">\"Add\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">await</span> userEvent<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">click</span><span class=\"token punctuation\">(</span>canvas<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getByRole</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"button\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">\"Add\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">await</span> userEvent<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">click</span><span class=\"token punctuation\">(</span>canvas<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getByRole</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"button\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">\"Add\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">await</span> userEvent<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">click</span><span class=\"token punctuation\">(</span>canvas<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getByRole</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"button\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">\"Add\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">await</span> userEvent<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">click</span><span class=\"token punctuation\">(</span>canvas<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getByRole</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"button\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">\"Reset\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p><code>Default.play = async ({ canvasElement }) => {</code>は Storybook6.4 でサポートされる<a href=\"https://storybook.js.org/blog/component-story-format-3-0/\">CSF3</a>の構文です。<br>\nまた、まだ v0.5 ですが Storybook から<a href=\"https://github.com/storybookjs/eslint-plugin-storybook\">eslint-plugin</a>も提供されているので、併せて試してみても良さそうです。</p>\n<p>Interactive stories の addon を追加した Storybook を GitHub Pages でホスティングしたので、実際に触ってみたい方は次のリンクへ。<br>\n<a href=\"https://nus3.github.io/p-storybook/?path=/story/components-examplecomponent--default\">https://nus3.github.io/p-storybook/?path=/story/components-examplecomponent--default</a></p>\n<p>Storybook 上で複雑な操作があるコンポーネントのデバッグや共有がしやすくなりそうですね。</p>\n<h2>参考リンク</h2>\n<ul>\n<li><a href=\"https://storybook.js.org/blog/interactive-stories-beta/\">https://storybook.js.org/blog/interactive-stories-beta/</a></li>\n<li><a href=\"https://storybook.js.org/blog/component-story-format-3-0/\">https://storybook.js.org/blog/component-story-format-3-0/</a></li>\n<li><a href=\"https://github.com/nus3/p-storybook\">実際に実装したリポジトリ</a></li>\n</ul>\n","metaData":{"title":"Interactive storiesを使ってStorybook上でユーザー操作の状態を確認する","author":"nus3","editor":["nakajmg","sakito"],"createdAt":"2021-11-29","summary":"Storybookに新しく追加されたInteractive storiesについて紹介します","tags":["Storybook"],"updatedAt":"2021-11-29"}}],"tag":"Storybook"},"__N_SSG":true}