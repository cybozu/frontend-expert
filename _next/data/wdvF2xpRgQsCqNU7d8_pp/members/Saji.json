{"pageProps":{"member":{"name":"Saji","twitterId":"sajikix","githubUsername":"sajikix","active":true},"posts":[{"slug":"release-chrome-96","content":"<p>Chrome 96 のリリースノート関連の情報をまとめました。</p>\n<ul>\n<li><a href=\"https://developer.chrome.com/blog/new-in-chrome-96/\">https://developer.chrome.com/blog/new-in-chrome-96/</a></li>\n<li><a href=\"https://developer.chrome.com/blog/new-in-devtools-96/\">https://developer.chrome.com/blog/new-in-devtools-96/</a></li>\n<li><a href=\"https://developer.chrome.com/blog/deps-rems-96/\">https://developer.chrome.com/blog/deps-rems-96/</a></li>\n<li><a href=\"https://www.chromestatus.com/features#milestone%3D96\">https://www.chromestatus.com/features#milestone%3D96</a></li>\n<li><a href=\"https://v8.dev/blog/v8-release-96\">https://v8.dev/blog/v8-release-96</a></li>\n</ul>\n<h2>New In Chrome (Chrome 96)</h2>\n<p>Chrome 96で新しく追加された機能です。</p>\n<h3>Manifest id for PWAs</h3>\n<p>今まではPWAをインストールする際、ブラウザ側でPWAを一意に識別するための明確な方法が存在しておらず、ブラウザの判断に委ねられていました。(実際ブラウザによってPWAマニフェストファイルの<code>start_url</code>が利用されていたり、マニフェストファイル自体のパスなどが利用されたりしています)</p>\n<p>今回のアップデートにより、マニフェストファイル内でPWAの識別子を<code>id</code>プロパティとして明示的に定義できるようになりました。</p>\n<p>マニフェストに<code>id</code>プロパティを追加すると、マニフェストファイルの<code>start_url</code>プロパティやマニフェストファイル場所へ依存がなくなり、これらのフィールドを更新することが容易になります。</p>\n<h4>サポート状況と予定</h4>\n<p>デスクトップのChromium搭載ブラウザ</p>\n<ul>\n<li>Chrome 96からidプロパティがサポートされます。</li>\n</ul>\n<p>モバイルブラウザ(マニフェストファイルのURLをユニークIDとして使用しているもの)</p>\n<ul>\n<li>2022年前半にサポートが開始される予定です。</li>\n</ul>\n<h4>idプロパティの追加について</h4>\n<p>すでに運用しているPWAのマニフェストファイルにidを追加する場合</p>\n<ul>\n<li>ブラウザから割り当てられたIDを使用する必要があります。</li>\n<li>割り当てられているID は、Dev Tools の <code>Application</code> パネルの <code>Manifest</code> ペインで確認できます。</li>\n</ul>\n<p>新しくPWAを作成する場合</p>\n<ul>\n<li>idプロパティに好きな文字列を設定することができますが、将来的に変更することはできないので慎重に選んでください。</li>\n</ul>\n<h3>URL protocol handlers for PWAs</h3>\n<p>今までwebページで利用可能だった<code>URL protocol handler</code>の登録がChrome 96からはPWAでもインストール時に行えるようになりました。</p>\n<p>PWAの場合は以下のように<code>protocol_handlers</code>プロパティをマニフェストファイルに記載することで登録できます。</p>\n<div class=\"remark-highlight\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  ...\n  <span class=\"token property\">\"protocol_handlers\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"protocol\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"web+tea\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"url\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/tea?type=%s\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"protocol\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"web+coffee\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"url\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/coffee?type=%s\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>それぞれ、<code>protocol</code>には登録したいプロトコル名を、<code>url</code>にはそのプロトコルのURLをクリックしたときに開いてほしいURLを指定します。ただし、これらのプロトコル登録にはいくつかの制限があります。詳細や登録方法などは<a href=\"https://web.dev/url-protocol-handler/\">こちら</a>を参照してください。</p>\n<h3>Priority hints (origin trial)</h3>\n<p>ブラウザがページ内リソース(<code>image</code>,<code>script</code>,<code>CSS</code>)を読み込む際の優先度ヒントを追加できる機能がOrigin Trialsとして実験的に利用できるようになりました。</p>\n<p>具体的には以下のような形で対象となるリソースに<code>importance</code>属性で優先度(<code>high</code>,<code>low</code>,<code>auto</code>から選択)を指定します。</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token comment\">&#x3C;!-- We don't want a high priority for this above-the-fold image --></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>img</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/not-important.svg<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">importance</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>low<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token comment\">&#x3C;!-- Initiate an early fetch for a resource, but de-prioritize it --></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>link</span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>preload<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/script.js<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">as</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>script<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">importance</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>low<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n  <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'https://example.com/'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>importance<span class=\"token operator\">:</span> <span class=\"token string\">'high'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// Trigger a high priority fetch</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>script</span><span class=\"token punctuation\">></span></span>\n</code></pre></div>\n<p>今回のリリースノートでは Google Flights ページで、<code>Priority hitns</code> の有無におけるLCP(最大視覚コンテンツの表示時間)の比較を行った結果を紹介しています。この比較では背景画像の<code>img</code>タグに対して<code>importance=\"high\"</code>を指定することでLCPが 2.6s から 1.9s に向上したとしています。</p>\n<p>機能詳細やOrigin Trialとして登録する方法、サンプルなどについては<a href=\"https://web.dev/priority-hints/\">Optimizing resource loading with Priority Hints</a>を参考にしてください。</p>\n<h3>Emulate Chrome 100 in the UA string</h3>\n<p>来年の早い段階でChromeはバージョン100がリリースされる予定であり、これ以降３桁のバージョン番号に突入します。そのため、バージョン番号を利用しているコードや<code>UserAgent</code>をパースしているコードが３桁のバージョン番号でも正しく動作することを保証する必要があります。</p>\n<p>これらを検証するためChrome 96では<code>#force-major-version-to-100</code>というフラグが追加されました。このフラグを有効にするとChromeのバージョンだけが100になった状態をシミュレートすることができ、バージョン番号を扱う動作に問題がないかの検証を行うことができます。</p>\n<p>詳しくは <a href=\"https://developer.chrome.com/blog/force-major-version-to-100/\">Force Chrome major version to 100 in the User-Agent string.</a> を参照してください。</p>\n<h3>Chrome Dev Summit</h3>\n<p>Chrome Dev Summitにおけるすべての動画やコンテンツはオンラインで視聴可能です。詳しくは <a href=\"https://developer.chrome.com/devsummit/\">Chrome Dev Summit site</a> をご覧ください。またkeynoteや配信を見逃した方はChrome Developers YouTube Channelの <a href=\"https://www.youtube.com/playlist?list=PLNYkxOF6rcIBju4hD9ed1pt6YO20LgLWg\">CDS Playlist</a> を合わせて参照してください。</p>\n<h3>その他</h3>\n<p><code>Back/forward cache</code>の機能が<code>stable</code>になりました。</p>\n<ul>\n<li>これによりFireFoxやSafariと挙動を揃えることができるようになりました。</li>\n</ul>\n<h2>What's New In DevTools (Chrome 96)</h2>\n<p>DevTools についてはこちらの日本語訳を参照ください。</p>\n<p><a href=\"https://developer.chrome.com/ja/blog/new-in-devtools-96/\">https://developer.chrome.com/ja/blog/new-in-devtools-96/</a></p>\n<h2>Deprecations and removals in Chrome 96</h2>\n<p>Chrome96で非推奨になったもの、もしくは削除されたものです<br>\n<a href=\"https://developer.chrome.com/blog/deps-rems-96/\">https://developer.chrome.com/blog/deps-rems-96/</a></p>\n<h3>The \"basic-card\" method of PaymentRequest API</h3>\n<p>PaymentRequestを呼び出すときに指定できる<code>basic card</code>method(ブラウザで保存されているカード情報を使う方法)が非推奨になります。</p>\n<p>Chrome 96では<code>basic card</code>を使っているとDevToolsのConsoleにwarningメッセージが表示されます。また、Chrome 100では利用できなくなります。<code>basic card</code>を使っている場合は別のmethodに変更するように早めに対応したほうが良さそうです。</p>\n<p><a href=\"https://blog.chromium.org/2021/10/sunsetting-basic-card-payment-method-in.html\">https://blog.chromium.org/2021/10/sunsetting-basic-card-payment-method-in.html</a></p>\n<h2>その他Chrome Platform Statusに記載されていたもの</h2>\n<p><a href=\"https://www.chromestatus.com/features#milestone%3D96\">https://www.chromestatus.com/features#milestone%3D96</a></p>\n<h3>Adding captureTimestamp and senderCaptureTimeOffset to RTCRtpContributingSource.</h3>\n<p>WebRTC APIの一つである<code>RTCRtpContributingSource</code>にオーディオとビデオフレームの同期やend-to-endの遅延が測定できる<code>captureTimestamp</code>と<code>senderCaptureTimeOffset</code>プロパティが追加されます。</p>\n<p><a href=\"https://www.chromestatus.com/feature/5728533701722112\">https://www.chromestatus.com/feature/5728533701722112</a></p>\n<h3>CSS @counter-style descriptor 'speak-as'</h3>\n<p><code>@counter-style</code>を使った際にカウンターが音声形式でどのように表されるかを指定できるプロパティ<code>speak-as</code>が追加予定で、現状は<code>In developer trial</code>で試験運用中です。</p>\n<p><a href=\"https://www.chromestatus.com/feature/5687059677184000\">https://www.chromestatus.com/feature/5687059677184000</a>\n<a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/@counter-style/speak-as\">https://developer.mozilla.org/en-US/docs/Web/CSS/@counter-style/speak-as</a></p>\n<h3>Clipboard: Preserve PNG metadata</h3>\n<p>クリップボードからPNGを読み込む際にサニタイズされなくなります。\n(前まではメタデータを削除していました)</p>\n<p><a href=\"https://www.chromestatus.com/feature/5629962485760000\">https://www.chromestatus.com/feature/5629962485760000</a></p>\n<h3>Cross-Origin-Embedder-Policy: credentialless</h3>\n<p>COEPに<code>credentialless</code>が追加できるようになりました。\n<code>credentialless</code>を指定するとサーバーへのリクエスト時に認証方法(CookieやAuthorizationヘッダなど)が省かれるようになります。</p>\n<p><a href=\"https://www.chromestatus.com/feature/4918234241302528\">https://www.chromestatus.com/feature/4918234241302528</a></p>\n<p>参考: SharedArrayBuffer と過渡期な cross-origin isolation の話\n<a href=\"https://blog.agektmr.com/2021/11/cross-origin-isolation.html\">https://blog.agektmr.com/2021/11/cross-origin-isolation.html</a></p>\n<h3>Disable propagation of body style to viewport when contained</h3>\n<p>ルートやbody要素に<code>contain: none</code>以外の値を使用するとbodyからのCSSプロパティの伝搬が無効になります。\n<a href=\"https://www.chromestatus.com/feature/5663240823504896\">https://www.chromestatus.com/feature/5663240823504896</a></p>\n<h3>EME MediaKeySession Closed Reason</h3>\n<p>MediaKeySessionのcloseメソッドが<code>MediaKeySessionClosedReason</code>を返すようになります。\nsessionが閉じられた理由(<code>internal-error</code>, <code>closed-by-application</code>など)を取得してハンドリングできるようになります。</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> keySystemAccess <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> <span class=\"token dom variable\">navigator</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">requestMediaKeySystemAccess</span><span class=\"token punctuation\">(</span>\n<span class=\"token comment\">//   ...</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Create media keys.</span>\n<span class=\"token keyword\">const</span> mediaKeys <span class=\"token operator\">=</span> <span class=\"token keyword control-flow\">await</span> keySystemAccess<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">createMediaKeys</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Create a key session.</span>\nkeySession <span class=\"token operator\">=</span> mediaKeys<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">createSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Generate a fake license request.</span>\n<span class=\"token keyword control-flow\">await</span> keySession<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">generateRequest</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"webm\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Uint8Array</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nkeySession<span class=\"token punctuation\">.</span><span class=\"token property-access\">closed</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">reason</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"token comment\">// Reason is either undefined if not supported, \"internal-error\",</span>\n<span class=\"token comment\">// \"closed-by-application\", \"release-acknowledged\",</span>\n<span class=\"token comment\">// \"hardware-context-reset\", or \"resource-evicted\".</span>\n<span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Media key session was closed. Reason: \"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>reason<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\".</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p><a href=\"https://www.chromestatus.com/feature/5632124143009792\">https://www.chromestatus.com/feature/5632124143009792</a></p>\n<p>参考: EME MediaKeySession Closed Reason Sample\n<a href=\"https://googlechrome.github.io/samples/media/key-session-closed-reason.html\">https://googlechrome.github.io/samples/media/key-session-closed-reason.html</a></p>\n<h3>HTTP->HTTPS redirect for HTTPS DNS records</h3>\n<p>DNSのHTTPSレコードを従来のAレコードやAAAAレコードと一緒に照会し、解析するようになります。\nHTTPSレコードを追加し、Chromeがそれを受信するとChromeは常にそのウェブサイトにHTTPSで接続します。</p>\n<p><a href=\"https://www.chromestatus.com/feature/5485544526053376\">https://www.chromestatus.com/feature/5485544526053376</a></p>\n<h3>InteractionID in EventTiming</h3>\n<p>Event Timing APIのPerformanceEventTimingに<code>interactionId</code>が追加されました。\nユーザーの操作に対して関連するイベント(たとえばユーザーがタップした時にはpointerdown→mousedown→pointerup→mouseup→clickのイベントが発生する)は<code>interactionId</code>が同じになります。</p>\n<p><a href=\"https://www.chromestatus.com/feature/5674224959094784\">https://www.chromestatus.com/feature/5674224959094784</a></p>\n<h3>Media Queries: prefers-contrast feature</h3>\n<p>OSが設定している色のコントラスト設定に対応するメディアクエリ<code>prefers-contrast</code>が追加されました。</p>\n<div class=\"remark-highlight\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\"><span class=\"token class\">.contrast</span></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/* ... */</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token atrule\"><span class=\"token rule\">@media</span> <span class=\"token punctuation\">(</span><span class=\"token property\">prefers-contrast</span><span class=\"token punctuation\">:</span> more<span class=\"token punctuation\">)</span></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token selector\"><span class=\"token class\">.contrast</span></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/* OSでコントラストの設定が高い場合に適応される */</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token atrule\"><span class=\"token rule\">@media</span> <span class=\"token punctuation\">(</span><span class=\"token property\">prefers-contrast</span><span class=\"token punctuation\">:</span> less<span class=\"token punctuation\">)</span></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token selector\"><span class=\"token class\">.contrast</span></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/* OSでコントラストの設定が低い場合に適応される */</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p><a href=\"https://www.chromestatus.com/feature/5646323212615680\">https://www.chromestatus.com/feature/5646323212615680</a></p>\n<p>参考: prefers-contrast(MDN)<br>\n<a href=\"https://developer.mozilla.org/ja/docs/Web/CSS/@media/prefers-contrast\">https://developer.mozilla.org/ja/docs/Web/CSS/@media/prefers-contrast</a></p>\n<h3>Support calc(<code>&#x3C;number></code>) where only accepts <code>&#x3C;integer></code></h3>\n<p>cssの<code>calc()</code>関数でintegerしか受け取らないような場所でもnumberを指定できるようになりました。\nもっとも近い整数に丸められます。</p>\n<p>例えば、下記はいずれも<code>column-count: 1</code>と同義です。</p>\n<div class=\"remark-highlight\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\"><span class=\"token class\">.example</span></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">column-count</span><span class=\"token punctuation\">:</span> <span class=\"token function\">calc</span><span class=\"token punctuation\">(</span><span class=\"token number\">1.2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token property\">column-count</span><span class=\"token punctuation\">:</span> <span class=\"token function\">calc</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.6</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p><a href=\"https://www.chromestatus.com/feature/5656451751084032\">https://www.chromestatus.com/feature/5656451751084032</a></p>\n<p>参考:\n<a href=\"https://drafts.csswg.org/css-values-4/#calc-range\">https://drafts.csswg.org/css-values-4/#calc-range</a></p>\n<h2>V8 release v9.6</h2>\n<p>V8のアップデート情報です。</p>\n<h3>WebAssembly : Reference Types</h3>\n<p>WebWebAssemblyでプロポーザルとして提案されている<a href=\"https://github.com/WebAssembly/reference-types/blob/master/proposals/reference-types/Overview.md\">Reference Type</a>がV8 v9.6からサポートされます。\n現状、WASMの関数は引数や戻り値に、整数や浮動小数点数といったプリミティブな型しか扱えませんが、<code>Reference Types</code>機能はこれに加えて、JavaScriptオブジェクトへの参照を渡せるようにしたものです。</p>\n","metaData":{"title":"Chrome 96 リリースノートまとめ","author":"Saji","editor":"nus3","createdAt":"2021-12-02","summary":"Chrome 96 のリリースノートの要約です","tags":["Releasenote","Browser"],"updatedAt":"2021-12-02"}}]},"__N_SSG":true}