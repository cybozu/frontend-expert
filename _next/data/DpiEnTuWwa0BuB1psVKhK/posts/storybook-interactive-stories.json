{"pageProps":{"post":{"slug":"storybook-interactive-stories","content":"<p><a href=\"https://github.com/storybookjs/storybook/releases/tag/v6.4.0\">Storybook の 6.4.0 がリリース</a>され、<code>Interactive stories</code>が新機能として追加されました。詳細は<a href=\"https://storybook.js.org/blog/interactive-stories-beta/\">Storybook のブログ</a>でも記載されています。</p>\n<h2>概要</h2>\n<p>Interactive stories の Addon を追加すると、testing-library で定義した操作を Storybook 上で確認することができるようになります。</p>\n<p>次の gif のようにユーザー操作に対するコンポーネントの状態を UI(Addon)からステップごとに確認できます。</p>\n<p></p>\n<h2>導入手順</h2>\n<ol>\n<li>パッケージを追加する</li>\n<li>Storybook の<code>main.js</code>に設定を追加する</li>\n<li>Interactive stories 用の story を<code>stories.tsx</code>に追加する</li>\n</ol>\n<h3>1. パッケージを追加する</h3>\n<p>Interactive addon を利用するには次のパッケージが必要です。<br>\n(今回は React のコンポーネントを対象としています)</p>\n<ul>\n<li>@storybook/addon-interactions</li>\n<li>@storybook/react</li>\n<li>@storybook/testing-library</li>\n</ul>\n<p>次のコマンドを実行してインストールします。</p>\n<p><code>npm i -D @storybook/addon-interactions @storybook/react @storybook/testing-library</code></p>\n<p>今回試したバージョンは次になります。</p>\n<div><pre><code><span>{</span>\n  <span>\"devDependencies\"</span><span>:</span> <span>{</span>\n    <span>\"@storybook/addon-interactions\"</span><span>:</span> <span>\"6.4.0\"</span><span>,</span>\n    <span>\"@storybook/react\"</span><span>:</span> <span>\"6.4.0\"</span><span>,</span>\n    <span>\"@storybook/testing-library\"</span><span>:</span> <span>\"0.0.7\"</span>\n  <span>}</span>\n<span>}</span>\n</code></pre></div>\n<h3>2. Storybook の<code>main.js</code>に設定を追加する</h3>\n<div><pre><code>module<span>.</span><span>exports</span> <span>=</span> <span>{</span>\n  <span>stories</span><span>:</span> <span>[</span><span>\"../src/components/**/**/*.stories.@(js|jsx|ts|tsx)\"</span><span>]</span><span>,</span>\n  <span>addons</span><span>:</span> <span>[</span><span>\"@storybook/addon-interactions\"</span><span>]</span><span>,</span> <span>// addonの追加</span>\n  <span>features</span><span>:</span> <span>{</span>\n    <span>interactionsDebugger</span><span>:</span> <span>true</span><span>,</span> <span>// Interactive storiesをaddonで1ステップずつ確認できるようにするのに必要</span>\n  <span>}</span><span>,</span>\n<span>}</span><span>;</span>\n</code></pre></div>\n<h3>3. Interactive stories 用の story を<code>stories.tsx</code>に追加する</h3>\n<p>例えば、次のサンプルコードでは Storybook 上にマウントされたコンポーネントに対して、<code>Add</code>のラベルがついたボタンを 4 回クリックした後に<code>Reset</code>のボタンをクリックする story を<code>@storybook/testing-library</code>を使って追加しています。</p>\n<div><pre><code><span>// Interactive storiesに関係ある部分しか記載してません</span>\n<span>import</span> <span><span>{</span> within<span>,</span> userEvent <span>}</span></span> <span>from</span> <span>\"@storybook/testing-library\"</span><span>;</span>\n\n<span>const</span> <span>Template</span><span>:</span> <span>Story</span><span>&#x3C;</span><span>ExampleComponentProps</span><span>></span> <span>=</span> <span>(</span>args<span>)</span> <span>=></span> <span>(</span>\n  <span><span><span>&#x3C;</span><span>ExampleComponent</span></span> <span><span>{</span><span>...</span>args<span>}</span></span> <span>/></span></span>\n<span>)</span><span>;</span>\n\n<span>export</span> <span>const</span> <span>Default</span> <span>=</span> <span>Template</span><span>.</span><span>bind</span><span>(</span><span>{</span><span>}</span><span>)</span><span>;</span>\n<span>Default</span><span>.</span><span>play</span> <span>=</span> <span>async</span> <span>(</span><span>{</span> canvasElement <span>}</span><span>)</span> <span>=></span> <span>{</span>\n  <span>const</span> canvas <span>=</span> <span>within</span><span>(</span>canvasElement<span>)</span><span>;</span>\n  <span>await</span> userEvent<span>.</span><span>click</span><span>(</span>canvas<span>.</span><span>getByRole</span><span>(</span><span>\"button\"</span><span>,</span> <span>{</span> name<span>:</span> <span>\"Add\"</span> <span>}</span><span>)</span><span>)</span><span>;</span>\n  <span>await</span> userEvent<span>.</span><span>click</span><span>(</span>canvas<span>.</span><span>getByRole</span><span>(</span><span>\"button\"</span><span>,</span> <span>{</span> name<span>:</span> <span>\"Add\"</span> <span>}</span><span>)</span><span>)</span><span>;</span>\n  <span>await</span> userEvent<span>.</span><span>click</span><span>(</span>canvas<span>.</span><span>getByRole</span><span>(</span><span>\"button\"</span><span>,</span> <span>{</span> name<span>:</span> <span>\"Add\"</span> <span>}</span><span>)</span><span>)</span><span>;</span>\n  <span>await</span> userEvent<span>.</span><span>click</span><span>(</span>canvas<span>.</span><span>getByRole</span><span>(</span><span>\"button\"</span><span>,</span> <span>{</span> name<span>:</span> <span>\"Add\"</span> <span>}</span><span>)</span><span>)</span><span>;</span>\n  <span>await</span> userEvent<span>.</span><span>click</span><span>(</span>canvas<span>.</span><span>getByRole</span><span>(</span><span>\"button\"</span><span>,</span> <span>{</span> name<span>:</span> <span>\"Reset\"</span> <span>}</span><span>)</span><span>)</span><span>;</span>\n<span>}</span><span>;</span>\n</code></pre></div>\n<p><code>Default.play = async ({ canvasElement }) => {</code>は Storybook6.4 でサポートされる<a href=\"https://storybook.js.org/blog/component-story-format-3-0/\">CSF3</a>の構文です。<br>\nまた、まだ v0.5 ですが Storybook から<a href=\"https://github.com/storybookjs/eslint-plugin-storybook\">eslint-plugin</a>も提供されているので、併せて試してみても良さそうです。</p>\n<p>Interactive stories の addon を追加した Storybook を GitHub Pages でホスティングしたので、実際に触ってみたい方は次のリンクへ。<br>\n<a href=\"https://nus3.github.io/p-storybook/?path=/story/components-examplecomponent--default\">https://nus3.github.io/p-storybook/?path=/story/components-examplecomponent--default</a></p>\n<p>Storybook 上で複雑な操作があるコンポーネントのデバッグや共有がしやすくなりそうですね。</p>\n<h2>参考リンク</h2>\n<ul>\n<li><a href=\"https://storybook.js.org/blog/interactive-stories-beta/\">https://storybook.js.org/blog/interactive-stories-beta/</a></li>\n<li><a href=\"https://storybook.js.org/blog/component-story-format-3-0/\">https://storybook.js.org/blog/component-story-format-3-0/</a></li>\n<li><a href=\"https://github.com/nus3/p-storybook\">実際に実装したリポジトリ</a></li>\n</ul>\n","metaData":{"title":"Interactive storiesを使ってStorybook上でユーザー操作の状態を確認する","author":"nus3","editor":["nakajmg","sakito"],"createdAt":"2021-11-29","summary":"Storybookに新しく追加されたInteractive storiesについて紹介します","tags":["Storybook"],"updatedAt":"2021-11-29"}}},"__N_SSG":true}