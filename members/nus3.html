<!DOCTYPE html><html lang="ja"><head><title>nus3 | サイボウズ フロントエンドエキスパートチーム</title><meta charSet="utf-8"/><meta name="viewport" content="initial-scale=1.0, width=device-width"/><meta name="description" content="サイボウズ フロントエンドエキスパートチームのウェブサイトです"/><link rel="icon" type="image/png" sizes="32x32" href="/frontend-expert/icons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/frontend-expert/icons/favicon-16x16.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="nus3 | サイボウズ フロントエンドエキスパートチーム"/><meta name="twitter:description" content="サイボウズ フロントエンドエキスパートチームのウェブサイトです"/><meta name="twitter:image " content="https://cybozu.github.io/frontend-expert/ogp/ogp.jpg"/><meta property="og:type" content="article"/><meta property="og:title" content="nus3 | サイボウズ フロントエンドエキスパートチーム"/><meta property="og:site_name" content="サイボウズ フロントエンドエキスパートチーム"/><meta property="og:description" content="サイボウズ フロントエンドエキスパートチームのウェブサイトです"/><meta property="og:image" content="https://cybozu.github.io/frontend-expert/ogp/ogp.jpg"/><link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/frontend-expert/feeds/atom.xml"/><meta name="next-head-count" content="16"/><link rel="preload" href="/frontend-expert/_next/static/css/76ea63cd4865a048.css" as="style"/><link rel="stylesheet" href="/frontend-expert/_next/static/css/76ea63cd4865a048.css" data-n-g=""/><link rel="preload" href="/frontend-expert/_next/static/css/167b2548c0061980.css" as="style"/><link rel="stylesheet" href="/frontend-expert/_next/static/css/167b2548c0061980.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/frontend-expert/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/frontend-expert/_next/static/chunks/webpack-729603c643508a46.js" defer=""></script><script src="/frontend-expert/_next/static/chunks/framework-46c1838cec3c6950.js" defer=""></script><script src="/frontend-expert/_next/static/chunks/main-d8805e7f2054e339.js" defer=""></script><script src="/frontend-expert/_next/static/chunks/pages/_app-ab65071b83dd12b3.js" defer=""></script><script src="/frontend-expert/_next/static/chunks/247-11af9d0831f37191.js" defer=""></script><script src="/frontend-expert/_next/static/chunks/pages/members/%5Bname%5D-9da81b2cc6f07ad5.js" defer=""></script><script src="/frontend-expert/_next/static/Z6zt42Qd6gAP6927zntYd/_buildManifest.js" defer=""></script><script src="/frontend-expert/_next/static/Z6zt42Qd6gAP6927zntYd/_ssgManifest.js" defer=""></script><script src="/frontend-expert/_next/static/Z6zt42Qd6gAP6927zntYd/_middlewareManifest.js" defer=""></script></head><body><div id="__next"><div class="Layout_layout__3Ma1v"><header class="Header_header__91Nua"><div class="Header_content__JIbnm"><h1><a href="/frontend-expert"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9Ijc4IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZlcnNpb249IjEuMSIvPg=="/></span><img alt="Frontend Expert Team Logo" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="Frontend Expert Team Logo" src="/frontend-expert/logo.png" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></a></h1><nav class="Header_navigation__2pqVF"><ul><li><a href="/frontend-expert/members">Members</a></li><li><a href="/frontend-expert/posts">Posts</a></li><li><a href="https://cybozu.co.jp/company/job/recruitment/list/front_end_expert.html" target="_blank" rel="noopener noreferrer">Recruiting</a></li></ul></nav></div></header><main class="Layout_main__3t9q9"><div class="Layout_content__2clJn"><div class="member_member__2D-qA"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:200px;height:200px;background:none;opacity:1;border:0;margin:0;padding:0;position:relative"><img alt="nus3" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="fixed" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="nus3" src="/frontend-expert//member-icons/nus3.jpg" decoding="async" data-nimg="fixed" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span><h1 class="member_memberName__3YKSY">nus3</h1><ul class="member_links__pW2oq"><li><a href="https://twitter.com/nus3_">Twitter</a></li><li><a href="https://github.com/nus3">GitHub</a></li></ul></div><div class="member_posts__3oAkN"><div><div class="Posts_postItem__3hs9O"><a href="/frontend-expert/posts/considerations-for-monorepo">2022-01-31 フロントエンドのモノレポ構成はスケーリングの夢を見るか</a></div><div class="Posts_postItem__3hs9O"><a href="/frontend-expert/posts/turborepo">2022-01-17 workspaceを使ったコマンドを最適化して実行するTurborepoについて</a></div><div class="Posts_postItem__3hs9O"><a href="/frontend-expert/posts/storybook-interactive-stories">2021-11-29 Interactive storiesを使ってStorybook上でユーザー操作の状態を確認する</a></div><div class="Posts_postItem__3hs9O"><a href="/frontend-expert/posts/release-chrome-95">2021-11-17 Chrome 95 リリースノートまとめ</a></div></div></div></div></main><footer class="Footer_footer__2epqf"><div class="Footer_content__3ovcH"><ul><li><a href="https://cybozu.co.jp/">サイボウズ 企業情報</a></li><li><a href="https://www.cybozu.com/jp/">cybozu.com</a></li><li><a href="https://blog.cybozu.io/">サイボウズエンジニアのブログ Cybozu Inside Out</a></li><li><a href="https://tech.cybozu.io/">Cybozu Tech</a></li><li><a href="https://cybozu.co.jp/company/job/recruitment/">採用情報</a></li></ul><small>Copyright © Cybozu, Inc.</small></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"member":{"name":"nus3","twitterId":"nus3_","githubUsername":"nus3","active":true},"posts":[{"slug":"considerations-for-monorepo","content":"\u003cp\u003eそれっぽいタイトルを付けましたが特に意味はないです。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://cybozu.github.io/frontend-expert/posts/turborepo\"\u003eworkspace を使ったコマンドを最適化して実行する Turborepo について\u003c/a\u003eのお話で Turborepo を軽く触ってみた際に\u003ccode\u003enpx create-turbo@latest\u003c/code\u003eで作られる構成がとてもわかりやすく、プロダクトの初期段階からモノレポを採用するのは選択肢の 1 つとしていいのでは、と思い続編を書きました。\u003c/p\u003e\n\u003cp\u003e前回と同じくサンプルのリポジトリはこちらになります。\u003cbr\u003e\n\u003ca href=\"https://github.com/nus3/p-turborepo/tree/main/yarn\"\u003ehttps://github.com/nus3/p-turborepo/tree/main/yarn\u003c/a\u003e\u003c/p\u003e\n\u003ch2\u003e概要\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eモノレポを採用することで、同一リポジトリ内で自作した汎用的なライブラリやコンポーネントを複数のアプリケーションで使いまわせる\u003c/li\u003e\n\u003cli\u003eモノレポの規模が大きくなってきた場合には、モノレポ内のパッケージを npm に公開することでアプリケーションとパッケージを非同期に開発できる\u003c/li\u003e\n\u003cli\u003eYarn や npm の workspace はイイゾ！\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003eモノレポとは\u003c/h2\u003e\n\u003cp\u003eモノレポとは本記事では npm や Yarn の workspaces 機能を使い、1 つのリポジトリ内で複数の npm パッケージを管理している構成のこととします。\u003c/p\u003e\n\u003ch3\u003enpm や Yarn の workspaces\u003c/h3\u003e\n\u003cp\u003enpm や Yarn の workspaces は 1 つのリポジトリ内で複数の npm パッケージを管理するための機能です。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://classic.yarnpkg.com/lang/en/docs/workspaces/\"\u003eYarn(v1)\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://yarnpkg.com/features/workspaces\"\u003eYarn(v2 以降)\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://docs.npmjs.com/cli/v8/using-npm/workspaces\"\u003enpm\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eworkspaces を使うにはリポジトリのルート直下にある\u003ccode\u003epackage.json\u003c/code\u003eに\u003ccode\u003eworkspaces\u003c/code\u003eを追加します。\u003c/p\u003e\n\u003cp\u003e例えば\u003ccode\u003eapps\u003c/code\u003e配下にアプリケーションの npm パッケージを、\u003ccode\u003epackages\u003c/code\u003e配下に汎用的なコンポーネント、ライブラリなどの npm パッケージを入れる場合、次のようになります。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-json\"\u003e\u003ccode class=\"language-json\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"workspaces\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"apps/*\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"packages/*\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003ccode\u003eapps\u003c/code\u003e 配下にある\u003ccode\u003enus3-a\u003c/code\u003eというアプリケーションから \u003ccode\u003epackages\u003c/code\u003e 配下にある\u003ccode\u003enus3-ui\u003c/code\u003eという名前の npm パッケージを使う場合、それぞれ次のような\u003ccode\u003epackage.json\u003c/code\u003eになります。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eapps/nus3-a\u003c/code\u003e\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-json\"\u003e\u003ccode class=\"language-json\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"name\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"nus3-a\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"version\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"0.0.0\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"dependencies\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003e\"nus3-ui\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"*\"\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e// Yarnのv2以降であれば`workspace:`構文が使えるようになる\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e// REF: (nus3) https://yarnpkg.com/features/workspaces#workspace-ranges-workspace\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e// \"nus3-ui\": \"workspace:*\"\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003ccode\u003epackages/nus3-ui\u003c/code\u003e\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-json\"\u003e\u003ccode class=\"language-json\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"name\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"nus3-ui\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"version\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"0.0.0\"\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eworkspaces 内にある npm パッケージの名前が npm に公開されているパッケージ名と同じ場合は、 workspace 内の npm パッケージが優先してインストールされます。後々 workspaces 内の npm パッケージを公開する可能性がある場合、パッケージ名は npm で公開されているパッケージ名と被らない名前にした方が良いかもしれません。\u003c/p\u003e\n\u003cp\u003eworkspace 内の npm パッケージを依存関係に追加すると node_modules にシンボリックリンクが作成されます。次の画像のように node_modules 配下に\u003ccode\u003enus3-ui\u003c/code\u003eと\u003ccode\u003enus3-a\u003c/code\u003eのシンボリックリンクが追加されていることが確認できます。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/frontend-expert/image/considerations-for-monorepo/symlink.png\" alt=\"node_modulesに作成されたシンボリックリンク\" width=\"340\" height=\"101\" \u003e\u003c/p\u003e\n\u003cp\u003eシンボリックリンクにより依存する npm パッケージのコードを直接参照するので、npm に公開しバージョン管理するまでは、version は\u003ccode\u003e0.0.0\u003c/code\u003e、かつ、使う側は\u003ccode\u003e\"nus3-ui\": \"*\"\u003c/code\u003eのようにワイルドカードを指定するとバージョンのことを意識せずに管理できます。\u003c/p\u003e\n\u003ch3\u003ecreate-turbo で作られるモノレポ構成\u003c/h3\u003e\n\u003cp\u003ecreate-turbo(\u003ccode\u003enpx create-turbo@latest\u003c/code\u003e) では作られるモノレポ構成に次のようなものが含まれます。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003enpm に公開せずに config をモノレポ内の別パッケージに分けて、複数のパッケージから使用する\u003c/li\u003e\n\u003cli\u003eReact を使った汎用的なコンポーネント(tsx)を別パッケージに分けて アプリケーション(Next.js)で使用する\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eそれぞれ見ていきましょう。\u003c/p\u003e\n\u003ch4\u003enpm に公開せずに config をモノレポ内の別パッケージに分けて、複数のパッケージから使用する\u003c/h4\u003e\n\u003cp\u003eESLint や Stylelint の config は npm に公開することで、異なるプロジェクトで共通の設定を使えます。サイボウズでは\u003ca href=\"https://github.com/cybozu/eslint-config\"\u003e@cybozu/eslint-config\u003c/a\u003eや\u003ca href=\"https://github.com/cybozu/stylelint-config\"\u003e@cybozu/stylelint-config\u003c/a\u003eとして npm に公開しています。\u003c/p\u003e\n\u003cp\u003eモノレポ内であれば ESLint や Stylelint の設定を npm に公開・管理せずに共有することもできます。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003epackages/nus3-config\u003c/code\u003e\u003cbr\u003e\nで共通の ESLint や TSConfig を定義して、\u003ccode\u003epackage.json\u003c/code\u003e の\u003ccode\u003efiles\u003c/code\u003e に指定します。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-json\"\u003e\u003ccode class=\"language-json\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"name\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"nus3-config\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"version\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"0.0.0\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"files\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\n    \u003cspan class=\"token string\"\u003e\"eslint-preset.js\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token string\"\u003e\"tsconfig.base.json\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token string\"\u003e\"tsconfig.nextjs.json\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token string\"\u003e\"tsconfig.react-library.json\"\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003ccode\u003eapps/nus3-a\u003c/code\u003e\nで\u003ccode\u003enus3-config\u003c/code\u003eを追加し、\u003ccode\u003enus3-config\u003c/code\u003eから TSConfig や ESLint のルールを適用します。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-json\"\u003e\u003ccode class=\"language-json\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"name\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"nus3-a\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"version\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"0.0.0\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"devDependencies\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003e\"eslint\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"8.6.0\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003e\"nus3-config\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"*\"\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003ccode\u003eapps/nus3-a/tsconfig.json\u003c/code\u003e\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-json\"\u003e\u003ccode class=\"language-json\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"extends\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"nus3-config/tsconfig.nextjs.json\"\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003ccode\u003eapps/nus3-a/.eslintrc\u003c/code\u003e\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003emodule\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eexports\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003erequire\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"nus3-config/eslint-preset\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch4\u003eReact を使った汎用的なコンポーネント(tsx)を別パッケージに分けて アプリケーション(Next.js)で使用する\u003c/h4\u003e\n\u003cp\u003ecreate-turbo では汎用的な React コンポーネントを tsx ファイルのまま \u003ccode\u003epackages\u003c/code\u003e 配下の npm パッケージで管理し、Next.js の\u003ca href=\"https://github.com/martpie/next-transpile-modules\"\u003eplugin\u003c/a\u003eを使って アプリケーション 側でトランスパイルしています。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003epackages/nus3-ui\u003c/code\u003e\u003cbr\u003e\nで React(tsx)のコンポーネントを実装します。実装した tsx ファイルのパスをそのまま\u003ccode\u003emain\u003c/code\u003eと\u003ccode\u003etypes\u003c/code\u003eに追加します。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-json\"\u003e\u003ccode class=\"language-json\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"name\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"nus3-ui\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"version\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"0.0.0\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"main\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"./index.tsx\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"types\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"./index.tsx\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"devDependencies\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003e\"@types/react\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"17.0.37\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003e\"@types/react-dom\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"17.0.11\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003e\"typescript\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"4.5.4\"\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003ccode\u003epackages/nus3-ui/index.tsx\u003c/code\u003e\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-tsx\"\u003e\u003ccode class=\"language-tsx\"\u003e\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token constant\"\u003eVFC\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"react\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eButton\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token function-variable function\"\u003eVFC\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003ebutton\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003eボタン\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003ebutton\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003ccode\u003eapps/nus3-a\u003c/code\u003e\u003cbr\u003e\n\u003ccode\u003enus3-ui\u003c/code\u003eの tsx ファイルを\u003ccode\u003enus3-a\u003c/code\u003eで\u003ccode\u003enext-transpile-modules\u003c/code\u003eを使ってトランスパイルします。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-json\"\u003e\u003ccode class=\"language-json\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"name\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"nus3-a\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"version\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"0.0.0\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"devDependencies\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003e\"next-transpile-modules\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"9.0.0\"\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003ccode\u003eapps/nus3-a/next.config.js\u003c/code\u003e\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e withTM \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003erequire\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"next-transpile-modules\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"nus3-ui\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\nmodule\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eexports\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003ewithTM\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2\u003eフロントエンドのモノレポ戦略\u003c/h2\u003e\n\u003cp\u003e筆者のこれまでの経験では、創業して間もない会社やプロダクトの初期フェーズで、複数のアプリケーションの開発が並列して始まることが多くありました。そういった状況では、モノレポを採用しておくと複数のアプリケーションで共通したコンポーネントやライブラリを少ないコストで使用できます。\u003c/p\u003e\n\u003cp\u003eまた、モノレポ内で共通して使っているパッケージに変更を加える際に、その影響範囲が把握できないくらいモノレポの規模が大きくなった場合には、パッケージを npm に公開してバージョン管理することで、バージョンの変更タイミングを各々のアプリケーションに任せることができ、アプリケーションとパッケージの開発を非同期に行うことができます。\u003c/p\u003e\n\u003cp\u003eこのように、初期段階では汎用的な npm パッケージをアセットとして複数のアプリケーションに提供することで開発スピードを上げられ、また、規模が大きくなってきた場合はパッケージを npm に公開するといった方針をとることもできます。\u003c/p\u003e\n\u003cp\u003eもちろん、1 つのリポジトリですべてのパッケージを管理することやコードベースが大きく複雑になることなどデメリットもあり、モノレポを採用することが適切ではない場合もあります。メリット・デメリットを踏まえつつ、フロントエンドの技術選定の中にモノレポの採用を選択肢の 1 つとして入れてもいいかもしれません。\u003c/p\u003e\n","metaData":{"title":"フロントエンドのモノレポ構成はスケーリングの夢を見るか","author":"nus3","editor":["nakajmg"],"createdAt":"2022-01-31","summary":"Turborepoのstarterでできるモノレポ構成からスケーリングするフロントエンドの構成について考える","tags":["Monorepo","Turborepo"],"updatedAt":"2022-01-31"}},{"slug":"turborepo","content":"\u003cp\u003e今年からフロントエンドエキスパートチームでは活動内容の一つである\u003cstrong\u003e探求\u003c/strong\u003eの一環として、メンバーが気になった技術に対して、気軽に触ってみる会をしています。次の画像は筆者が Slack で、気軽に触ってみる会の開催を宣言してる時のものです。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/frontend-expert/image/turborepo/slack.png\" alt=\"slackで気軽に触ってみる会を宣言してる\" width=\"718\" height=\"152.15061295971978\" \u003e\u003c/p\u003e\n\u003cp\u003e今回は\u003ca href=\"https://vercel.com/blog/vercel-acquires-turborepo\"\u003e去年の 12 月に Vercel に買収されたニュース\u003c/a\u003eがあった Turborepo を気軽に触ってみました。\n個人的には 1 人で調べるときよりも複数人でわいわい調べた方が、その技術や関連する周辺知識の話を色んな人の観点で深掘ってできて、とても有意義な時間でした。\u003c/p\u003e\n\u003ch2\u003e概要\u003c/h2\u003e\n\u003cp\u003eTurborepo はモノレポのためのビルドシステムで次のような特徴があります。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eYarn, npm, pnpm の workspaces に対応してるリポジトリに対して簡単に導入できる\u003c/li\u003e\n\u003cli\u003eworkspace 内のコマンドの依存関係をシンプルに設定してくれる\u003c/li\u003e\n\u003cli\u003eTurborepo で実行するコマンドがない package はスルーしてくれる(npm workspace の\u003ccode\u003e--if-present\u003c/code\u003eに相当)\u003c/li\u003e\n\u003cli\u003eローカルキャッシュ、リモートキャッシュを生成・利用できる\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3\u003eサンプルで作ったモノレポ構成\u003c/h3\u003e\n\u003cp\u003e今回は Yarn v1 の workspace を使ってます。\u003cbr\u003e\n\u003ca href=\"https://github.com/nus3/p-turborepo/tree/main/yarn\"\u003ehttps://github.com/nus3/p-turborepo/tree/main/yarn\u003c/a\u003e\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-unknown\"\u003e\u003ccode class=\"language-unknown\"\u003e├── apps\n│   └── nus3-a: Next.js\n└── packages:\n    ├── nus3-button2: Reactのコンポーネント + ViteのLibrary Modeでビルド\n    ├── nus3-config: tsconfig + eslintのconfig\n    └── nus3-ui: Reactのコンポーネント(ビルドせずに使う)\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eサンプルで作ったモノレポ内の package たちは次のような依存関係になっています。\u003cbr\u003e\n(色々試してたので適当な命名になってます。すんません)\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003enus3-a\u003c/code\u003eは\u003ccode\u003enus3-ui\u003c/code\u003eと\u003ccode\u003enus3-button2\u003c/code\u003eに依存している\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003enus3-ui\u003c/code\u003eは\u003ccode\u003enus3-button2\u003c/code\u003eに依存している\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg src=\"/frontend-expert/image/turborepo/dependencies.png\" alt=\"サンプルリポジトリの依存関係\" width=\"577\" height=\"314\" \u003e\u003c/p\u003e\n\u003ch3\u003e使い方\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003e使っているパッケージマネージャーで(Yarn, npm, pnpm)で workspace の設定\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eturbo\u003c/code\u003eのインストール\u003c/li\u003e\n\u003cli\u003epackage.json に\u003ccode\u003epipeline\u003c/code\u003eの設定\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch4\u003e1. 使っているパッケージマネージャーで(Yarn, npm, pnpm)で workspace の設定\u003c/h4\u003e\n\u003cp\u003eworkspace の設定については割愛します。各パッケージマネージャーのドキュメントをご覧ください。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://classic.yarnpkg.com/lang/en/docs/workspaces/\"\u003eYarn\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://docs.npmjs.com/cli/v8/using-npm/workspaces\"\u003enpm\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://pnpm.io/workspaces\"\u003epnpm\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4\u003e2. \u003ccode\u003eturbo\u003c/code\u003eのインストール\u003c/h4\u003e\n\u003cp\u003e\u003ccode\u003eyarn add turbo -W --dev\u003c/code\u003eで Turborepo を追加します。\u003c/p\u003e\n\u003ch4\u003e3. package.json に\u003ccode\u003epipeline\u003c/code\u003eの設定\u003c/h4\u003e\n\u003cp\u003e\u003ccode\u003epackage.json\u003c/code\u003eに\u003ccode\u003eturbo.pipeline\u003c/code\u003eを追加し、そこで\u003ccode\u003eturbo run {command}\u003c/code\u003eで実行する command の依存関係やキャッシュの設定をします。この\u003ccode\u003epipeline\u003c/code\u003eで定義した command しか\u003ccode\u003eturbo run {command}\u003c/code\u003eでは実行できません。\u003c/p\u003e\n\u003cp\u003e実際に定義したものが次の json になります。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-json\"\u003e\u003ccode class=\"language-json\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"turbo\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003e\"pipeline\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token property\"\u003e\"build\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token property\"\u003e\"dependsOn\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"^build\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"token property\"\u003e\"outputs\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"dist/**\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\".next/**\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"token property\"\u003e\"test\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token property\"\u003e\"dependsOn\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"build\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"token property\"\u003e\"lint\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"token property\"\u003e\"deploy\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token property\"\u003e\"dependsOn\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"build\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"test\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"lint\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003ccode\u003edependsOn\u003c/code\u003eで依存関係を、\u003ccode\u003eoutputs\u003c/code\u003eでキャッシュするものを指定します。\u003c/p\u003e\n\u003cp\u003e定義したコマンドを一つずつ見ていきましょう。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-json\"\u003e\u003ccode class=\"language-json\"\u003e\u003cspan class=\"token property\"\u003e\"dependsOn\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"^build\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003edependOn に\u003ccode\u003e^\u003c/code\u003eを追加したコマンド(\u003ccode\u003e^build\u003c/code\u003e)を指定することで workspace 内の各 package の指定したコマンド(\u003ccode\u003ebuild\u003c/code\u003e)を package 間の依存関係を考慮した順番で実行してくれます。\u003c/p\u003e\n\u003cp\u003e実際に実行してみると、サンプルで作った各 package の依存関係を考慮した順番(\u003ccode\u003e@nus3/example-button2\u003c/code\u003e → \u003ccode\u003enus3-ui\u003c/code\u003e → \u003ccode\u003enus3-a\u003c/code\u003e)でビルドされていることがわかります。\u003cbr\u003e\n(※今回サンプルで作った構成では\u003ccode\u003enus3-ui\u003c/code\u003eはビルドの必要がないですが、依存関係を考慮した順番を表すのにあえて build コマンドを追加しています)\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-unknown\"\u003e\u003ccode class=\"language-unknown\"\u003e$ turbo run build\n• Packages in scope: @nus3/example-button2, nus3-a, nus3-config, nus3-ui\n• Running build in 4 packages\n@nus3/example-button2:build: cache miss, executing a161062b16a0be35\n@nus3/example-button2:build: $ vite build \u0026#x26;amp;\u0026#x26;amp; tsc -p ./tsconfig.build.json\n...\n@nus3/example-button2:build: dist/nus3-example-button2.es.js   3.30 KiB / gzip: 1.39 KiB\nnus3-ui:build: cache miss, executing b32d4fb848c8658f\nnus3-ui:build: $ echo \u0026#x26;#39;build nus3-ui\u0026#x26;#39;\n...\nnus3-a:build: cache miss, executing a80d8842624981a8\nnus3-a:build: $ next build\n...\n\n Tasks:    3 successful, 3 total\nCached:    0 cached, 3 total\n  Time:    5.702s\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e次の\u003ccode\u003eoutputs\u003c/code\u003eはコマンドを実行した際に、\u003ccode\u003edist\u003c/code\u003eと\u003ccode\u003e.next\u003c/code\u003e配下にあるファイル群をキャッシュする設定です。\u003ccode\u003enode_modules/.cache/turbo\u003c/code\u003eにキャッシュしたファイルが出力されます。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-json\"\u003e\u003ccode class=\"language-json\"\u003e\u003cspan class=\"token property\"\u003e\"outputs\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"dist/**\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\".next/**\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e先程の build コマンドをもう一度実行すると cache が使われ、前回より早く実行されているのがわかります。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-unknown\"\u003e\u003ccode class=\"language-unknown\"\u003e$ turbo run build\n• Packages in scope: @nus3/example-button2, nus3-a, nus3-config, nus3-ui\n• Running build in 4 packages\n@nus3/example-button2:build: cache hit, replaying output a161062b16a0be35\n...\nnus3-ui:build: cache hit, replaying output b32d4fb848c8658f\n...\nnus3-a:build: cache hit, replaying output a80d8842624981a8\n...\n\n Tasks:    3 successful, 3 total\nCached:    3 cached, 3 total\n  Time:    221ms \u0026#x26;gt;\u0026#x26;gt;\u0026#x26;gt; FULL TURBO\n\n✨  Done in 0.57s.\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e次のように何も指定しない場合、依存関係がないものとして認識され並列に実行されます\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-json\"\u003e\u003ccode class=\"language-json\"\u003e\u003cspan class=\"token property\"\u003e\"lint\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e次の deploy コマンドの\u003ccode\u003edependsOn\u003c/code\u003eでは pipeline で定義した\u003ccode\u003ebuild\u003c/code\u003e, \u003ccode\u003etest\u003c/code\u003e, \u003ccode\u003elint\u003c/code\u003e(順不同)を実行し、終了した時点で workspace 内の各 package の\u003ccode\u003edeploy\u003c/code\u003eコマンドを実行します。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-json\"\u003e\u003ccode class=\"language-json\"\u003e\u003cspan class=\"token property\"\u003e\"deploy\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"dependsOn\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"build\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"test\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"lint\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e今回定義したものの場合、Turborepo は次のようなことを考慮しながら各々の package のコマンドを実行します。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003ebuild\u003c/code\u003e: モノレポ内の各 package の依存関係を考慮しつつ build\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003etest\u003c/code\u003e: \u003ccode\u003epipeline\u003c/code\u003eで定義した\u003ccode\u003ebuild\u003c/code\u003eが実行された後に実行\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003elint\u003c/code\u003e: 他のコマンドの順番を気にせず、並列で実行\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003edeploy コマンドを実行した結果が次になります。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-unknown\"\u003e\u003ccode class=\"language-unknown\"\u003e$ turbo run deploy\n• Packages in scope: @nus3/example-button2, nus3-a, nus3-config, nus3-ui\n• Running deploy in 4 packages\nnus3-a:lint: $ next lint\n@nus3/example-button2:build: $ vite build \u0026#x26;amp;amp;\u0026#x26;amp;amp; tsc -p ./tsconfig.build.json\n...\nnus3-ui:build: $ echo \u0026#x26;#39;build nus3-ui\u0026#x26;#39;\n...\nnus3-a:build: $ next build\n...\nnus3-a:test: $ echo \u0026#x26;#39;test nus3-a\u0026#x26;#39;\n...\nnus3-a:deploy: $ echo \u0026#x26;#39;deploy nus3-a\u0026#x26;#39;\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e実際に上記を考慮しつつ各 package のコマンドが実行された後に、最後に deploy コマンドが実行されているのがわかると思います。\u003c/p\u003e\n\u003cp\u003eまた、今回はローカルキャッシュの話のみでしたが、Turborepo には\u003ca href=\"https://turborepo.org/docs/features/remote-caching#vercel\"\u003eVercel\u003c/a\u003eや\u003ca href=\"https://turborepo.org/docs/features/remote-caching#custom-remote-caches\"\u003e独自\u003c/a\u003eにキャッシュを配置することで、同じハッシュのキャッシュがあった場合にそのキャッシュを使ってくれる\u003cstrong\u003eリモートキャッシュ\u003c/strong\u003eといった機能も Beta で用意されています。\u003c/p\u003e\n\u003cp\u003e今のプロジェクトが Yarn や npm の workspace を使っているのであれば、Turborepo を試しに入れてみてもいいかもしれません。\u003c/p\u003e\n","metaData":{"title":"workspaceを使ったコマンドを最適化して実行するTurborepoについて","author":"nus3","createdAt":"2022-01-17","summary":"Turborepoの機能について","tags":["Turborepo","Monorepo"],"updatedAt":"2022-01-17"}},{"slug":"storybook-interactive-stories","content":"\u003cp\u003e\u003ca href=\"https://github.com/storybookjs/storybook/releases/tag/v6.4.0\"\u003eStorybook の 6.4.0 がリリース\u003c/a\u003eされ、\u003ccode\u003eInteractive stories\u003c/code\u003eが新機能として追加されました。詳細は\u003ca href=\"https://storybook.js.org/blog/interactive-stories-beta/\"\u003eStorybook のブログ\u003c/a\u003eでも記載されています。\u003c/p\u003e\n\u003ch2\u003e概要\u003c/h2\u003e\n\u003cp\u003eInteractive stories の Addon を追加すると、testing-library で定義した操作を Storybook 上で確認することができるようになります。\u003c/p\u003e\n\u003cp\u003e次の gif のようにユーザー操作に対するコンポーネントの状態を UI(Addon)からステップごとに確認できます。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/frontend-expert/image/storybook-interactive-stories/capture.gif\" alt=\"Interactive addonを使った例\" width=\"360\" height=\"240\" \u003e\u003c/p\u003e\n\u003ch2\u003e導入手順\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003eパッケージを追加する\u003c/li\u003e\n\u003cli\u003eStorybook の\u003ccode\u003emain.js\u003c/code\u003eに設定を追加する\u003c/li\u003e\n\u003cli\u003eInteractive stories 用の story を\u003ccode\u003estories.tsx\u003c/code\u003eに追加する\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3\u003e1. パッケージを追加する\u003c/h3\u003e\n\u003cp\u003eInteractive addon を利用するには次のパッケージが必要です。\u003cbr\u003e\n(今回は React のコンポーネントを対象としています)\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e@storybook/addon-interactions\u003c/li\u003e\n\u003cli\u003e@storybook/react\u003c/li\u003e\n\u003cli\u003e@storybook/testing-library\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e次のコマンドを実行してインストールします。\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003enpm i -D @storybook/addon-interactions @storybook/react @storybook/testing-library\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e今回試したバージョンは次になります。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-json\"\u003e\u003ccode class=\"language-json\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"devDependencies\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003e\"@storybook/addon-interactions\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"6.4.0\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003e\"@storybook/react\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"6.4.0\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token property\"\u003e\"@storybook/testing-library\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"0.0.7\"\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch3\u003e2. Storybook の\u003ccode\u003emain.js\u003c/code\u003eに設定を追加する\u003c/h3\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003emodule\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003eexports\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  stories\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"../src/components/**/**/*.stories.@(js|jsx|ts|tsx)\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  addons\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"@storybook/addon-interactions\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// addonの追加\u003c/span\u003e\n  features\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    interactionsDebugger\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// Interactive storiesをaddonで1ステップずつ確認できるようにするのに必要\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch3\u003e3. Interactive stories 用の story を\u003ccode\u003estories.tsx\u003c/code\u003eに追加する\u003c/h3\u003e\n\u003cp\u003e例えば、次のサンプルコードでは Storybook 上にマウントされたコンポーネントに対して、\u003ccode\u003eAdd\u003c/code\u003eのラベルがついたボタンを 4 回クリックした後に\u003ccode\u003eReset\u003c/code\u003eのボタンをクリックする story を\u003ccode\u003e@storybook/testing-library\u003c/code\u003eを使って追加しています。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-tsx\"\u003e\u003ccode class=\"language-tsx\"\u003e\u003cspan class=\"token comment\"\u003e// Interactive storiesに関係ある部分しか記載してません\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"token imports\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e within\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e userEvent \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"@storybook/testing-library\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eTemplate\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eStory\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token maybe-class-name\"\u003eExampleComponentProps\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003eargs\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eExampleComponent\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token spread\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e...\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003eargs\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eDefault\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token maybe-class-name\"\u003eTemplate\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003ebind\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token maybe-class-name\"\u003eDefault\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method-variable function-variable method function property-access\"\u003eplay\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e canvasElement \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e canvas \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003ewithin\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecanvasElement\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003eawait\u003c/span\u003e userEvent\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eclick\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecanvas\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003egetByRole\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"button\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e name\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"Add\"\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003eawait\u003c/span\u003e userEvent\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eclick\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecanvas\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003egetByRole\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"button\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e name\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"Add\"\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003eawait\u003c/span\u003e userEvent\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eclick\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecanvas\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003egetByRole\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"button\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e name\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"Add\"\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003eawait\u003c/span\u003e userEvent\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eclick\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecanvas\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003egetByRole\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"button\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e name\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"Add\"\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003eawait\u003c/span\u003e userEvent\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eclick\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecanvas\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003egetByRole\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"button\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e name\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"Reset\"\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003ccode\u003eDefault.play = async ({ canvasElement }) =\u003e {\u003c/code\u003eは Storybook6.4 でサポートされる\u003ca href=\"https://storybook.js.org/blog/component-story-format-3-0/\"\u003eCSF3\u003c/a\u003eの構文です。\u003cbr\u003e\nまた、まだ v0.5 ですが Storybook から\u003ca href=\"https://github.com/storybookjs/eslint-plugin-storybook\"\u003eeslint-plugin\u003c/a\u003eも提供されているので、併せて試してみても良さそうです。\u003c/p\u003e\n\u003cp\u003eInteractive stories の addon を追加した Storybook を GitHub Pages でホスティングしたので、実際に触ってみたい方は次のリンクへ。\u003cbr\u003e\n\u003ca href=\"https://nus3.github.io/p-storybook/?path=/story/components-examplecomponent--default\"\u003ehttps://nus3.github.io/p-storybook/?path=/story/components-examplecomponent--default\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eStorybook 上で複雑な操作があるコンポーネントのデバッグや共有がしやすくなりそうですね。\u003c/p\u003e\n\u003ch2\u003e参考リンク\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://storybook.js.org/blog/interactive-stories-beta/\"\u003ehttps://storybook.js.org/blog/interactive-stories-beta/\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://storybook.js.org/blog/component-story-format-3-0/\"\u003ehttps://storybook.js.org/blog/component-story-format-3-0/\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/nus3/p-storybook\"\u003e実際に実装したリポジトリ\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n","metaData":{"title":"Interactive storiesを使ってStorybook上でユーザー操作の状態を確認する","author":"nus3","editor":["nakajmg","sakito"],"createdAt":"2021-11-29","summary":"Storybookに新しく追加されたInteractive storiesについて紹介します","tags":["Storybook"],"updatedAt":"2021-11-29"}},{"slug":"release-chrome-95","content":"\u003cp\u003eChrome 95 のリリースノート関連の情報をまとめました。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://developer.chrome.com/blog/new-in-chrome-95/\"\u003ehttps://developer.chrome.com/blog/new-in-chrome-95/\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://developer.chrome.com/blog/new-in-devtools-95/\"\u003ehttps://developer.chrome.com/blog/new-in-devtools-95/\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://developer.chrome.com/blog/deps-rems-95/\"\u003ehttps://developer.chrome.com/blog/deps-rems-95/\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.chromestatus.com/features#milestone%3D95\"\u003ehttps://www.chromestatus.com/features#milestone%3D95\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003eRouting with URLPattern\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003eURLPattern\u003c/code\u003eという機能が追加されました。現在は Chrome、Edge の 95 以上に対応しています。\u003c/p\u003e\n\u003cp\u003e他のブラウザや Node.js ではまだサポートされていない機能ですが、\u003ca href=\"https://github.com/kenchris/urlpattern-polyfill\"\u003eurlpattern-polyfill\u003c/a\u003eで polyfill できます。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e pattern \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eURLPattern\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e pathname\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"/books/:id\"\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token console class-name\"\u003econsole\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003elog\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epattern\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003etest\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"https://example.com/books/123\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// true\u003c/span\u003e\n\u003cspan class=\"token console class-name\"\u003econsole\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003elog\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epattern\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eexec\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"https://example.com/books/123\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003epathname\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003egroups\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// { id: '123' }\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// 引数で渡せる全てのプロパティ\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e p \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eURLPattern\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  protocol\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"http{s}?\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  username\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\":username\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  password\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\":password\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  hostname\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\":subdomain.example.com\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  port\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\":port(80|443)\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  pathname\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"/:path\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  search\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"*\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  hash\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"*\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e詳細はこちら\n\u003ca href=\"https://web.dev/urlpattern/\"\u003ehttps://web.dev/urlpattern/\u003c/a\u003e\u003c/p\u003e\n\u003ch2\u003ePicking colors with the Eye Dropper API\u003c/h2\u003e\n\u003cp\u003eカラーを取得する Eye Dropper API が追加されました\u003c/p\u003e\n\u003cp\u003e詳細はこちらの記事で解説しています。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://cybozu.github.io/frontend-expert/posts/eyedropper-api\"\u003eChrome 95 で追加された画面上の色を取得する EyeDropper API について\u003c/a\u003e\u003c/p\u003e\n\u003ch2\u003ePWA Summit\u003c/h2\u003e\n\u003cp\u003e10 月 6~7 日に PWA Summit が開催されてました\u003cbr\u003e\n見逃した方はアーカイブが下記のリンクに残ってるので、そこから確認できます\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://pwasummit.org/\"\u003ehttps://pwasummit.org/\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://www.youtube.com/channel/UC1j3gvdVISAEO1_2MwA5oQw/videos\"\u003ehttps://www.youtube.com/channel/UC1j3gvdVISAEO1_2MwA5oQw/videos\u003c/a\u003e\u003c/p\u003e\n\u003ch2\u003eUser-agent reduction origin trial\u003c/h2\u003e\n\u003cp\u003eOrigin Trial で実際に User-Agent の文字列が削減された後の挙動が試せます\u003c/p\u003e\n\u003cp\u003e参考:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://web.dev/user-agent-client-hints/\"\u003eUser-Agent Client Hints によるユーザーのプライバシーと開発者体験の改善\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://developers-jp.googleblog.com/2021/09/chrome-user-agent.html\"\u003eUser-Agent Reduction origin trial(日本語訳)\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003eAnd more!\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eStorage Foundation API を origin trial で試せます\u003c/li\u003e\n\u003cli\u003eWebAssembly で例外処理のサポートが提供され、例外がスローされたときにコードが中断できるようになります\u003c/li\u003e\n\u003cli\u003eChrome 100 が来年きます。バージョンが 2 桁から 3 桁になるので、自分のコードに何らかの影響があるかどうかを確認するといいかもしれません\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003eDevTools\u003c/h2\u003e\n\u003cp\u003eDevTools についてはこちらの日本語訳を参照ください。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://developer.chrome.com/ja/blog/new-in-devtools-95/\"\u003ehttps://developer.chrome.com/ja/blog/new-in-devtools-95/\u003c/a\u003e\u003c/p\u003e\n\u003ch2\u003eDeprecations and removals in Chrome 95\u003c/h2\u003e\n\u003cp\u003eChrome 95 で非推奨になったもの、もしくは削除されたものです。\u003c/p\u003e\n\u003ch3\u003eSupport for URLs with non-IPv4 hostnames ending in numbers\u003c/h3\u003e\n\u003cp\u003e有効な IPv4 アドレスではない、 \u003ccode\u003ehttp://foo.127.1/\u003c/code\u003e のような数字で終わる host name を持つ URL が拒否されるようになります。\u003c/p\u003e\n\u003cp\u003e社内のプレビュー環境などで IP アドレスをポストフィックスとして利用してたりする場合は影響がでているかもしれません。\u003c/p\u003e\n\u003ch3\u003eWebAssembly cross-origin module sharing\u003c/h3\u003e\n\u003cp\u003ecross-originでsame-siteな環境間でのWebAssemblyモジュールの共有が非推奨になりました\n\u003ca href=\"https://www.chromestatus.com/feature/5650158039597056\"\u003ehttps://www.chromestatus.com/feature/5650158039597056\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e合わせてこちらも参考にしてください\u003cbr\u003e\n\u003ca href=\"https://developer.chrome.com/blog/wasm-module-sharing-restricted-to-same-origin/\"\u003eRestricting Wasm module sharing to same-origin\u003c/a\u003e\u003c/p\u003e\n\u003ch3\u003eDeprecate U2F API (Cryptotoken)\u003c/h3\u003e\n\u003cp\u003eU2F API が非推奨になり、Chrome 98 からはデフォルトで無効になります。\u003c/p\u003e\n\u003cp\u003eU2F とはなんぞやという人はこちらの記事が参考になります。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://blog.jxck.io/entries/2018-05-15/webauthentication-api.html\"\u003eWeb Authentication API で FIDO U2F(YubiKey) 認証 | blog.jxck.io\u003c/a\u003e\u003c/p\u003e\n\u003ch2\u003eその他 Chrome Platform Status に記載されていたもの\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://www.chromestatus.com/features#milestone=95\"\u003ehttps://www.chromestatus.com/features#milestone=95\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3\u003eBack-forward cache for same-site navigations on Android\u003c/h3\u003e\n\u003cp\u003eChrome 86 から origin trial で試せていた Android での戻る/進むのキャッシュが same-site で効くようになりました。\u003cbr\u003e\n\u003ca href=\"https://www.chromestatus.com/feature/5694778600587264\"\u003ehttps://www.chromestatus.com/feature/5694778600587264\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003ebfcache(Back/forward cache)については下記に詳細の説明が載っています。\u003cbr\u003e\n\u003ca href=\"https://web.dev/bfcache/\"\u003ehttps://web.dev/bfcache/\u003c/a\u003e\u003c/p\u003e\n\u003ch3\u003eCSS @counter-style rules in shadow trees\u003c/h3\u003e\n\u003cp\u003eShadow tree に対してカスタムの counter-style を定義することができるようになりました。\u003cbr\u003e\n\u003ca href=\"https://www.chromestatus.com/feature/5716198446596096\"\u003ehttps://www.chromestatus.com/feature/5716198446596096\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e@counter-style\u003c/code\u003eについては下記を参考ください\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-css\"\u003e\u003ccode class=\"language-css\"\u003e\u003cspan class=\"token atrule\"\u003e\u003cspan class=\"token rule\"\u003e@counter-style\u003c/span\u003e circled-alpha\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003esystem\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e fixed\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003esymbols\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e Ⓐ Ⓑ Ⓒ Ⓓ Ⓔ Ⓕ Ⓖ Ⓗ Ⓘ Ⓙ Ⓚ Ⓛ Ⓜ Ⓝ Ⓞ Ⓟ Ⓠ Ⓡ Ⓢ Ⓣ Ⓤ Ⓥ Ⓦ Ⓧ Ⓨ Ⓩ\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003esuffix\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\" \"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token selector\"\u003e\u003cspan class=\"token class\"\u003e.items\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003elist-style\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e circled-alpha\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eこのスタイルを当てた list を作ると次のようなリストができます。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-unknown\"\u003e\u003ccode class=\"language-unknown\"\u003eⒶ One\nⒷ Two\nⒸ Three\nⒹ Four\nⒺ FIve\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003ca href=\"https://developer.mozilla.org/ja/docs/Web/CSS/@counter-style#specifying_symbols_with_counter-style\"\u003ehttps://developer.mozilla.org/ja/docs/Web/CSS/@counter-style#specifying_symbols_with_counter-style\u003c/a\u003e\u003c/p\u003e\n\u003ch3\u003eCookie size limits\u003c/h3\u003e\n\u003cp\u003eSet-Cookie header、及び、document.cookie、CookieStore で設定される Cookie のサイズが制限されます。\n具体的には Cookie の名前と値の合計が 4096 バイトまでになり、Cookie の各属性値は 1024 バイトに制限する必要があります。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://www.chromestatus.com/feature/4946713618939904\"\u003ehttps://www.chromestatus.com/feature/4946713618939904\u003c/a\u003e\u003c/p\u003e\n\u003ch3\u003eLogical properties for contain-intrinsic-size\u003c/h3\u003e\n\u003cp\u003econtain-intrinsic-size を省略した次の表記が追加されます。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003econtain-intrinsic-{width,height}\u003c/li\u003e\n\u003cli\u003econtain-intrinsic-{inline,block}-size\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003ca href=\"https://www.chromestatus.com/feature/5709654999957504\"\u003ehttps://www.chromestatus.com/feature/5709654999957504\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e参考:\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://drafts.csswg.org/css-sizing-4/#intrinsic-size-override\"\u003ehttps://drafts.csswg.org/css-sizing-4/#intrinsic-size-override\u003c/a\u003e\u003c/p\u003e\n\u003ch3\u003econtain-intrinsic-size\u003c/h3\u003e\n\u003cp\u003econtent-visibility で指定された要素の自然なサイズを制御するプロパティです。\u003c/p\u003e\n\u003cp\u003e次の実装は画面外の section のレンダリングをスキップする例です。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-html\"\u003e\u003ccode class=\"language-html\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003estyle\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token style\"\u003e\u003cspan class=\"token language-css\"\u003e\n\u003cspan class=\"token selector\"\u003esection\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003econtent-visibility\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e auto\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003econtain-intrinsic-size\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e \u003cspan class=\"token number\"\u003e500\u003c/span\u003e\u003cspan class=\"token unit\"\u003epx\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003estyle\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eビューポート外のコンテンツはレンダリングされなくなります。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://developer.mozilla.org/ja/docs/Web/CSS/content-visibility\"\u003ehttps://developer.mozilla.org/ja/docs/Web/CSS/content-visibility\u003c/a\u003e\u003c/p\u003e\n\u003ch3\u003eNew UA platform version source on Windows for User-Agent Client Hints\u003c/h3\u003e\n\u003cp\u003eWindows の Sec-CH-UA-Platform-Version(User-Agent Client Hints)で返されるバージョンが Windows プラットフォームの違いを識別できるように更新されました。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://www.chromestatus.com/feature/5080939765956608\"\u003ehttps://www.chromestatus.com/feature/5080939765956608\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://github.com/WICG/ua-client-hints/issues/220#issuecomment-870858413\"\u003ehttps://github.com/WICG/ua-client-hints/issues/220#issuecomment-870858413\u003c/a\u003e\u003c/p\u003e\n\u003ch3\u003eNote taking new note URL\u003c/h3\u003e\n\u003cp\u003eWeb Application Manifest が \u003ccode\u003enote_taking\u003c/code\u003e と \u003ccode\u003enew_note_url\u003c/code\u003e に対応しました。\nWeb Application 側から新しいメモを書きたい時にユーザーエージェントに読み込ませたい URL を指定できるようになります。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://www.chromestatus.com/feature/5205972320518144\"\u003ehttps://www.chromestatus.com/feature/5205972320518144\u003c/a\u003e\u003cbr\u003e\n\u003ca href=\"https://wicg.github.io/manifest-incubations/index.html#note_taking-member\"\u003ehttps://wicg.github.io/manifest-incubations/index.html#note_taking-member\u003c/a\u003e\u003c/p\u003e\n\u003ch3\u003eSecure payment confirmation\u003c/h3\u003e\n\u003cp\u003eWebAuthn を利用して、Web 上での支払い時の認証を強化することができるようになります。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://www.chromestatus.com/feature/5702310124584960\"\u003ehttps://www.chromestatus.com/feature/5702310124584960\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e※ Payment Request API で簡単・高速な決済を実現する\n\u003ca href=\"https://developers.google.com/web/updates/2016/07/payment-request?hl=ja\"\u003ehttps://developers.google.com/web/updates/2016/07/payment-request?hl=ja\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e※ PaymentRequestAPI で secure-payment-confirmation を使った実装例\n\u003ca href=\"https://www.w3.org/TR/2021/WD-secure-payment-confirmation-20210831/#sctn-sample-authentication\"\u003ehttps://www.w3.org/TR/2021/WD-secure-payment-confirmation-20210831/#sctn-sample-authentication\u003c/a\u003e\u003c/p\u003e\n\u003ch3\u003edroppedEntriesCount in PerformanceObserver callback\u003c/h3\u003e\n\u003cp\u003ePerformanceObserver のコールバックに droppedEntriesCount が追加されます。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://www.chromestatus.com/feature/5320666234486784\"\u003ehttps://www.chromestatus.com/feature/5320666234486784\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003ePerformanceObserver\u003cbr\u003e\n\u003ca href=\"https://developer.mozilla.org/ja/docs/Web/API/PerformanceObserver\"\u003ehttps://developer.mozilla.org/ja/docs/Web/API/PerformanceObserver\u003c/a\u003e\u003c/p\u003e\n\u003ch3\u003eself.reportError()\u003c/h3\u003e\n\u003cp\u003eキャッチされない例外をレポートする\u003ccode\u003eself.reportError()\u003c/code\u003eが追加されます。\n\u003ca href=\"https://www.chromestatus.com/feature/5634523220934656\"\u003ehttps://www.chromestatus.com/feature/5634523220934656\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e以下のコードを実行するとerrorはcatchで握り潰されずに\u003ccode\u003eUncaught Error: foo\u003c/code\u003eになります。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token function-variable function\"\u003eaddition\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003ea\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e b\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ea \u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003ereportError\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eError\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'foo'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e a \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e b\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token function-variable function\"\u003ecount\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003ea\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e b\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e callback\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003etry\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003ecallback\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ea\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e b\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003ecatch\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eerror\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token console class-name\"\u003econsole\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003elog\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'bar'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token function\"\u003ecount\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e3\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e addition\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e参考:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://html.spec.whatwg.org/#runtime-script-errors\"\u003ehttps://html.spec.whatwg.org/#runtime-script-errors\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n","metaData":{"title":"Chrome 95 リリースノートまとめ","author":"nus3","editor":"nakajmg","createdAt":"2021-11-17","summary":"Chrome 95 のリリースノートの要約です","tags":["Releasenote","Browser"],"updatedAt":"2021-11-17"}}]},"__N_SSG":true},"page":"/members/[name]","query":{"name":"nus3"},"buildId":"Z6zt42Qd6gAP6927zntYd","assetPrefix":"/frontend-expert","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>